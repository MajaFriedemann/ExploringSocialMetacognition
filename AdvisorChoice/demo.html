<!DOCTYPE html>
<html lang="en">
<head>
    <title>Advisor Choice Experiment</title>

    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="../src/sha1.js"></script>
    <script src="../src/bowser.min.js"></script>

    <!--Custom HTML components-->
    <script src="../src/customElements/InstructionDiv.js"></script>
    <script src="../src/customElements/HelpDiv.js"></script>
    <script src="../src/customElements/ResponseTimeline.js" type="module"></script>
    <!--/ Custom HTML components-->

    <link rel="stylesheet" type="text/css" href="../style/structure.css"/>
    <link rel="stylesheet" type="text/css" href="../style/function.css"/>
    <link rel="stylesheet" type="text/css" href="../style/advisorsGroups.css"/>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Templates -->
    <template id="countdown">
        <!-- Inspired by https://codepen.io/carsy/pen/VvqJwm -->
        <div class="counter">
            <svg>
                <circle r="10px" cx="50%" cy="50%"></circle>
            </svg>
            <span>?</span>
        </div>
    </template>
    <template id="advisor-key">
        <div class="advisor-key-row">
            <span>Advisor Name</span>
            <div class="response-marker advisor medium static"></div>
        </div>
    </template>

    <template id="instr-intro">
        <esm-instruction>
            <esm-instruction-page>
                <h1>Welcome</h1>
                <p>We first need to switch to fullscreen mode to begin the study.</p>
            </esm-instruction-page>
            <!--<esm-instruction-page>
                <h1>About the study</h1>
                <p>In this study you will see a series of events that occurred between <strong>1890</strong> and <strong>2010</strong>. Your task is to identify the year in which that event occurred. You will do this by dragging a marker onto a timeline.</p>
                <p>It is <strong>very important</strong> that you <strong>do not look up the answers</strong>. You will get to see the answers at the end of the study.</p>
            </esm-instruction-page>
            <esm-instruction-page>
                <h1>Scoring</h1>
                <p>You will have three markers to choose from, a thick marker, a medium marker, and a thin marker. The markers are worth different numbers of points. When your score is calculated, you will get the number of points the marker is worth for all the questions where a marker touches the correct year.</p>
                <p>The thinner the marker is, the fewer years it covers, but the more points you get if you get the answer right. This means you will do better if you use different markers depending upon how confident you are that you know the answer.</p>
            </esm-instruction-page>
            <esm-instruction-page>
                <h1>Advice</h1>
                <p>To help you complete the task, you will receive advice from advisors. You will see the advisors who are giving you advice on the left of your screen. One or more of those advisors may give you advice on each question.</p>
                <p>The advisors will mark their advice on the timeline by adding their own marker. The advisors aren't always correct, but they are quite good at the task. Part of your job is to identify which advisors are best and to weigh their advice accordingly.</p>
            </esm-instruction-page>
            <esm-instruction-page>
                <h1>Summary</h1>
                <p>For most questions you will give an initial answer, see advice, and then give a final answer. For some questions you will just give an initial answer.</p>
                <p>It is <strong>very important</strong> that you <strong>do not look up the answers</strong>. You will get to see the answers at the end of the study.</p>
            </esm-instruction-page>-->
        </esm-instruction>
    </template>
    <template id="instr-practice">
        <esm-instruction>
            <esm-instruction-page>
                <h1>Practice</h1>
                <p>You will now have an opportunity to practice the task. You will get feedback on your performance while you are doing the practice, and you'll be told how well you did overall once you have done all the practice rounds.</p>
                <p>Throughout the practice you can use the ? in the top-right to see the help for any part of the screen again.</p>
                <p>It is <strong>very important</strong> that you <strong>do not look up the answers</strong>. You will get to see the answers at the end of the study.</p>
            </esm-instruction-page>
        </esm-instruction>
    </template>
    <template id="instr-final">
        <esm-instruction>
            <esm-instruction-page>
                <h1>Main experiment</h1>
                <p>You are now ready to begin the main experiment.</p>
                <p>Please make sure you are in a quiet environment where you can concentrate properly.</p>
            </esm-instruction-page>
            <esm-instruction-page>
                <h1>Main experiment</h1>
                <p>If you are still unsure of how the study works, you can go through the tutorial again by closing the page and relaunching it from the link you were provided.</p>
                <p>If you're happy with how it works, let's go!</p>
            </esm-instruction-page>
        </esm-instruction>
    </template>
    <template id="block-break">
        <esm-instruction>
            <esm-instruction-page>
                <h1>Break</h1>
                <p>You may take a short break here if you wish. Use the button below when you're ready to continue.</p>
            </esm-instruction-page>
        </esm-instruction>
    </template>
    <template id="instr-debrief">
        <esm-instruction data-no-buttons="true">
            <esm-instruction-page>
                <h1>Thanks!</h1>
                <p>Thank you for completing my study.</p>
                <p>You did pretty well. I haven't calculated how well, yet, but trust me, pretty well.</p>
            </esm-instruction-page>
        </esm-instruction>
    </template>
    <template id="feedback">
        <div class="feedback-wrapper">
            <div class="debrief">
                <p class="payment-link">
                    Payment code: <a href="https://app.prolific.ac/submissions/complete?cc=MX5PC2Z4" target="_blank">MX5PC2Z4</a>
                </p>
                <p>Overall you got <span class="nCorrect"></span>/<span class="n"></span> (<span class="percentCorrect"></span>%) correct (filled stars), giving you a total of <span class="score"></span> points.</p>
            </div>
            <div class="display">
                <p>Your answers are shown below. Click/touch a marker to see the correct answer and your confidence interval.</p>
                <div class="legend permalink">
                    link
                    <div><span class="permalink" title="Direct link to these results" onclick="document.execCommand('copy')"></span></div>
                </div>
                <div class="timeline">
                    <div class="line"></div>
                </div>
                <p class="prompt">Click a marker for more info...</p>
            </div>
        </div>
    </template>
</head>
<body tabindex="0">
<div class="content-wrapper">
    <div id="content">
        <div class="progress-bar">
            <div class="outer">
                <div class="inner"></div>
            </div>
            <esm-help data-group="interface" class="bottom">
                The <em>progress bar</em> shows how far through the study you are.
            </esm-help>
        </div>
        <div class="frame top">
            <div class="left">
                <div class="advisor-key"></div>
                <esm-help data-group="interface" class="right">
                    This area of the screen will display the advisors who might give you advice on a question. At the moment you don't have any advisors so the area is empty.
                </esm-help>
            </div>
            <div class="middle">
                <div id="stimulus"></div>
                <div id="prompt">Prompt text</div>
                <esm-help data-group="interface" class="bottom">
                    This is the <em>question</em> you have to answer.
                </esm-help>
            </div>
            <!--<div class="right"></div>-->
        </div>
        <div class="frame bottom">
            <esm-response-timeline id="response-panel" data-min="1890"
                                 data-max="2010" data-prefix=""
                                 data-suffix="" data-decimals="0"
                                 data-no-confidence="true" data-label-step="10" data-marker-width-thin="3" data-marker-width-medium="9" data-marker-width-thick="27">
                <div class="response-timeline">
                    <div class="response-line"></div>
                </div>
                <div class="response-marker-pool">
                    <div>
                        <div class="label">&plusmn;1 year (9pts)</div>
                        <div class="response-marker thin"></div>
                    </div>
                    <div>
                        <div class="label">&plusmn;4 years (3pts)</div>
                        <div class="response-marker medium"></div>
                    </div>
                    <div>
                        <div class="label">&plusmn;13 years (1pts)</div>
                        <div class="response-marker thick"></div>
                    </div>
                    <div>
                        <div class="buttons">
                            <button class="confirm" title="confirm response">&check;
                            </button>
                            <!--<button class="comment" title="write a note or complaint about this question">!?
                            </button>-->
                        </div>
                    </div>
                </div>
            </esm-response-timeline>
            <esm-help data-group="interface" data-parent-click-closes="false" class="top wide">
                This <em>response panel</em> allows you to indicate your
                answer. When enabled, you will pick up one of the markers and drag it to the desired place on the timeline. A correct answer is one where the marker covers the actual year of the event. Try entering a response now.
            </esm-help>
        </div>
        <button id="help-button" onclick="toggleHelp()">?</button>
        <div id="instructions">
            Instructions
        </div>
        <div id="training-instructions" class="hidden">
            Click or Touch the tooltip above to move on...
        </div>
    </div>
</div>
<script type="text/javascript">
    /**
     * Toggle between help enabled/disabled.
     */
    function toggleHelp() {
        document.querySelectorAll("esm-help").forEach((elm) => elm.toggle());

        window.event.currentTarget.classList.toggle("show-help");
    }
</script>
<script type="module">
    "use strict";

    import {Study, DatesStudy} from "../src/modules/Study.js";
    import {Trial, AdvisedTrial} from "../src/modules/Trial.js";
    import {Advisor} from "../src/modules/Advisor.js";
    import * as utils from "../src/utils.js";

    // Procedural stuff

    AdvisedTrial.reset();

    window.DEBUG = {};
    DEBUG.level = parseInt(utils.getQueryStringValue("debug"));

    let studyBlueprint = {
        attentionCheckTrials: [10,17],
        blockLength: [2, 15, 15],
        practiceBlocks: 1,
        questionsXML: "assets/etc/questions.xml"
    };

    // shorter study in debug mode
    if(DEBUG.level >= 1 && !utils.getQueryStringValue("fb"))
        studyBlueprint.blockLength = [2, 2];

    window.study = new DatesStudy(studyBlueprint);

    if(utils.getQueryStringValue("fb"))
        study.awaitTrialLoading()
            .then(()=>study.run("results")
                .then(console.log));
    else
        study.run()
            .then(console.log);

    // Hoist for debugging
    window.Study = Study;
    window.DatesStudy = DatesStudy;
    window.Trial = Trial;
    window.AdvisedTrial = AdvisedTrial;
    window.Advisor = Advisor;

</script>
</body>
</html>